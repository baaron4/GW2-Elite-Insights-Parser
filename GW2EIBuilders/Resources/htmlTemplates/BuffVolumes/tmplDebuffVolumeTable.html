<template>
    <div>
        <buff-volume-table-component :key="'debuff-volume-stats-table'"  :outgoing="false"
            :id="'debuff-volume-stats-table'" :buffs="debuffs" :playerdata="buffData" :sums="[]" :playerindex="playerindex" :hidecustom="false">
        </buff-volume-table-component>
    </div>
</template>

<script>
    Vue.component("debuff-volume-table-component", {
        props: ['playerindex', 'activeduration'],
        mixins: [buffComponent, encounterPhaseComponent],
        template: `${template}`,
        data: function () {
            return {
                cache: new Map()
            };
        },
        computed: {
            buffData: function () {
                const cacheID = this.encounterPhase.id + '-' +  this.phaseindex + '-' + this.activeduration;
                if (this.cache.has(cacheID)) {
                    return this.cache.get(cacheID);
                }

                const players = getActiveNonFakePlayersForPhase(this.encounterPhase);
                var getData = function (stats) {
                    var uptimes = [];
                    var i;
                    for (i = 0; i < players.length; i++) {
                        var player = players[i];
                        if (!player) {
                            continue;
                        }
                        uptimes.push({
                            player: player,
                            data: stats[i]
                        });
                    }
                    return uptimes;
                };
                var res;
                if (this.activeduration) {
                    res = getData(this.buffVolumesStatContainer.debuffVolumeActiveStats);
                } else {
                    res = getData(this.buffVolumesStatContainer.debuffVolumeStats);
                }
                this.cache.set(cacheID, res);
                return res;
            }
        },
    });
</script>